generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id          String    @id @default(cuid())
  title       String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  price       Int       @default(0)
  description String?
  season      Season
  year        Int
  variants    Variant[]

  @@index([year, season])
}

model Variant {
  id         String   @id @default(cuid())
  color      String
  thumbnails String[]
  productId  String
  colorCode  String?  @db.VarChar(7)
  sizes      Size[]
  product    Product  @relation(fields: [productId], references: [id])

  @@unique([productId, colorCode], name: "uniq_variant_colorcode_per_product")
}

model Size {
  id        String  @id @default(cuid())
  label     String
  stock     Int
  variantId String
  variant   Variant @relation(fields: [variantId], references: [id])
}

model StockSnapshot {
  merchantTradeNo String   @id
  itemsJson       String   // 存 [{id,color,size,qty}, ...] 的 JSON 字串
  createdAt       DateTime @default(now())
  processedAt     DateTime? // 第一次成功扣庫存的時間，避免重複扣
}

enum Season {
  SS
  FW
  AW
}
